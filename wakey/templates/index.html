<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="theme-color" content="#111113">
  <title>Wakey</title>
  <link rel="stylesheet" href="/static/style.css?v=3">
</head>
<body>
  <div id="connection-banner" class="connection-banner hidden">Not connected to Wakey</div>

  <!-- Main View -->
  <div id="view-main" class="view active">
    <div class="clock" id="clock">00:00</div>
    <div class="date" id="date-display"></div>
    <div class="next-alarm" id="next-alarm"></div>

    <div id="alarm-active-panel" class="alarm-active-panel hidden">
      <div class="alarm-status" id="alarm-status-text"></div>
      <div class="alarm-actions">
        <button class="btn btn-snooze" id="btn-snooze">Snooze</button>
        <button class="btn btn-dismiss" id="btn-dismiss">Dismiss</button>
      </div>
    </div>

    <div class="home-alarms-header">
      <span class="home-alarms-title section-header">Alarms</span>
      <button class="btn btn-add" id="btn-add-alarm">+</button>
    </div>
    <div id="home-alarms" class="home-alarms"></div>

    <div class="nav-bar">
      <button class="btn btn-nav" id="btn-go-music">Music</button>
      <button class="btn btn-nav" id="btn-go-hue">Lights</button>
      <button class="btn btn-nav" id="btn-go-settings">Settings</button>
    </div>
  </div>

  <!-- Edit Alarm View -->
  <div id="view-edit" class="view">
    <div class="view-header">
      <button class="btn btn-back" id="btn-back-main">&larr;</button>
      <h2 id="edit-title">Edit Alarm</h2>
      <button class="btn btn-delete" id="btn-delete-alarm">Delete</button>
    </div>
    <form id="alarm-form" class="alarm-form">
      <div class="form-group">
        <label for="f-time">Time</label>
        <input type="time" id="f-time" required>
      </div>

      <div class="form-group">
        <label for="f-label">Label</label>
        <input type="text" id="f-label" placeholder="Optional label">
      </div>

      <div class="form-group">
        <label>Days</label>
        <div class="day-pills" id="f-days">
          <button type="button" class="pill" data-day="0">Mon</button>
          <button type="button" class="pill" data-day="1">Tue</button>
          <button type="button" class="pill" data-day="2">Wed</button>
          <button type="button" class="pill" data-day="3">Thu</button>
          <button type="button" class="pill" data-day="4">Fri</button>
          <button type="button" class="pill" data-day="5">Sat</button>
          <button type="button" class="pill" data-day="6">Sun</button>
        </div>
      </div>

      <fieldset class="form-group">
        <legend>Audio</legend>
        <div class="source-toggle" id="f-source-toggle">
          <button type="button" class="source-btn active" data-source="radio">Radio</button>
          <button type="button" class="source-btn" data-source="spotify">Spotify</button>
        </div>
        <div id="f-source-radio">
          <div class="form-row">
            <label for="f-station">Station</label>
            <select id="f-station"></select>
          </div>
        </div>
        <div id="f-source-spotify" style="display:none">
          <div class="form-row">
            <label for="f-spotify-preset">Preset</label>
            <select id="f-spotify-preset"><option value="">-- Select --</option></select>
          </div>
        </div>
        <div class="form-row">
          <label for="f-volume">Volume <span id="f-volume-val">70</span>%</label>
          <input type="range" id="f-volume" min="10" max="100" value="70" style="flex:1">
        </div>
      </fieldset>

      <fieldset class="form-group">
        <legend>Sunrise Lights</legend>
        <div class="form-row">
          <label>
            <input type="checkbox" id="f-hue-enabled" checked>
            Enable sunrise
          </label>
        </div>
        <div class="form-row">
          <label>Rooms</label>
          <button type="button" class="btn btn-small" id="btn-refresh-rooms">Refresh</button>
        </div>
        <div id="f-hue-rooms" class="room-checkboxes"></div>
        <div class="form-row">
          <label for="f-hue-scene">Scene (after sunrise)</label>
          <select id="f-hue-scene"><option value="">None</option></select>
        </div>
        <div class="form-row warmth-row">
          <label>Warmth</label>
          <span class="warmth-end">Cool</span>
          <input type="range" id="f-hue-warmth" min="153" max="500" value="326" style="flex:1">
          <span class="warmth-end">Warm</span>
        </div>
        <div class="form-row">
          <label for="f-hue-offset">Start <span id="f-offset-val">20</span> min before</label>
          <input type="range" id="f-hue-offset" min="5" max="45" value="20" style="flex:1">
        </div>
      </fieldset>

      <fieldset class="form-group">
        <legend>Advanced</legend>
        <div class="form-row">
          <label for="f-snooze">Snooze <span id="f-snooze-val">9</span> min</label>
          <input type="range" id="f-snooze" min="1" max="30" value="9" style="flex:1">
        </div>
        <div class="form-row">
          <label for="f-autostop">Auto-stop <span id="f-autostop-val">30</span> min</label>
          <input type="range" id="f-autostop" min="5" max="60" value="30" style="flex:1">
        </div>
      </fieldset>

      <button type="submit" class="btn btn-save">Save</button>
    </form>
  </div>

  <!-- Music View -->
  <div id="view-music" class="view">
    <div class="view-header">
      <button class="btn btn-back" id="btn-back-main-music">&larr;</button>
      <h2>Music</h2>
      <div></div>
    </div>

    <!-- Music sub-tabs -->
    <div class="music-tabs">
      <button class="music-tab active" data-tab="radio">Radio</button>
      <button class="music-tab" data-tab="spotify">Spotify</button>
    </div>

    <!-- Radio sub-panel -->
    <div id="music-radio" class="music-panel active">
      <div class="radio-player">
        <div class="radio-display">
          <div class="radio-indicator" id="radio-indicator"></div>
          <div class="radio-now-playing" id="radio-now-playing">Select a station</div>
        </div>

        <div class="radio-station-list" id="radio-station-list"></div>

        <div class="radio-controls">
          <button class="btn btn-play" id="btn-radio-play">Play</button>
          <button class="btn btn-stop" id="btn-radio-stop">Stop</button>
        </div>

        <div id="radio-status" class="status-msg"></div>
      </div>
    </div>

    <!-- Spotify sub-panel -->
    <div id="music-spotify" class="music-panel">
      <div id="spotify-unavailable" class="hue-notice" style="display:none">
        <p>Spotify Connect not available.</p>
        <p class="hint">Make sure go-librespot is running on the Pi.</p>
      </div>

      <div id="spotify-idle" style="display:none">
        <div class="spotify-connect-prompt">
          <p>Open Spotify on your phone and select <strong>Wakey</strong> as the playback device.</p>
          <div class="hint" style="margin-top:8px">The Pi appears as a Spotify Connect speaker.</div>
        </div>
      </div>

      <div id="spotify-active" style="display:none">
        <div class="spotify-now-playing">
          <div class="spotify-track-info">
            <div class="spotify-track" id="sp-track">Not playing</div>
            <div class="spotify-artist" id="sp-artist"></div>
          </div>
        </div>

        <div class="spotify-controls">
          <button class="btn btn-small" id="btn-sp-prev">&laquo;</button>
          <button class="btn btn-play" id="btn-sp-play">Play</button>
          <button class="btn btn-small" id="btn-sp-next">&raquo;</button>
        </div>

        <div class="spotify-controls-secondary">
          <button class="btn btn-small sp-toggle" id="btn-sp-shuffle">Shuffle</button>
          <button class="btn btn-small sp-toggle" id="btn-sp-repeat">Repeat</button>
        </div>
      </div>

      <!-- Saved playlists (always visible when Spotify available) -->
      <div id="spotify-presets-section" style="display:none">
        <div class="spotify-presets-header">
          <span class="spotify-presets-title section-header">Saved Playlists</span>
          <button class="btn btn-add" id="btn-add-preset">+</button>
        </div>
        <div id="spotify-presets" class="spotify-presets"></div>

        <div id="preset-form" class="preset-form" style="display:none">
          <input type="text" id="preset-name" placeholder="Name (e.g. Morning Mix)">
          <input type="text" id="preset-uri" placeholder="Paste Spotify link or URI">
          <div class="preset-form-actions">
            <button class="btn btn-save" id="btn-save-preset">Save</button>
            <button class="btn btn-small" id="btn-cancel-preset">Cancel</button>
          </div>
        </div>
      </div>
    </div>

    <!-- Speaker volumes (shared across tabs) -->
    <div id="music-bt-volumes" class="music-bt-volumes"></div>
  </div>

  <!-- Lights View -->
  <div id="view-hue" class="view">
    <div class="view-header">
      <button class="btn btn-back" id="btn-back-main-hue">&larr;</button>
      <h2>Lights</h2>
      <div></div>
    </div>

    <div id="hue-not-configured" class="hue-notice" style="display:none">
      <p>Hue Bridge not configured.</p>
      <button class="btn btn-small" id="btn-goto-hue-settings">Go to Settings</button>
    </div>

    <div id="hue-rooms-container">
      <div id="hue-rooms" class="hue-rooms"></div>
    </div>

    <div id="hue-scenes-panel" class="hue-scenes-panel" style="display:none">
      <div class="hue-scenes-header">
        <span class="hue-scenes-title section-header" id="hue-scenes-title">Scenes</span>
        <button class="btn btn-small" id="btn-close-scenes">&times;</button>
      </div>
      <div id="hue-scenes-list" class="hue-scenes-list"></div>
    </div>

    <div id="lights-status" class="status-msg"></div>
  </div>

  <!-- Settings View -->
  <div id="view-settings" class="view">
    <div class="view-header">
      <button class="btn btn-back" id="btn-back-main-settings">&larr;</button>
      <h2>Settings</h2>
      <div></div>
    </div>

    <!-- Bluetooth Speakers -->
    <section class="config-section">
      <h3 class="section-header">Bluetooth Speakers</h3>
      <div id="bt-connected-list" class="bt-connected-list"></div>
      <div class="config-actions">
        <button class="btn btn-test" id="btn-bt-scan">Scan for Devices</button>
      </div>
      <div id="bt-status" class="status-msg"></div>
      <div id="bt-devices" class="bt-device-list"></div>
      <p class="hint">Connect multiple speakers to play audio on all of them simultaneously.</p>
    </section>

    <!-- Hue Connection -->
    <section class="config-section">
      <h3 class="section-header">Philips Hue</h3>
      <div class="form-group">
        <label for="cfg-hue-ip">Bridge IP</label>
        <input type="text" id="cfg-hue-ip" placeholder="192.168.1.x">
      </div>
      <div class="form-group">
        <label for="cfg-hue-user">API Username</label>
        <input type="text" id="cfg-hue-user" placeholder="Generated automatically">
      </div>
      <div class="config-actions">
        <button class="btn btn-test" id="btn-generate-key">Generate API Key</button>
        <button class="btn btn-save" id="btn-save-hue">Save</button>
      </div>
      <p class="hint">Press the button on your Hue Bridge, then tap Generate.</p>
      <div class="config-actions" style="margin-top: 8px">
        <button class="btn btn-small" id="btn-test-hue">Test Connection</button>
      </div>
      <div id="hue-status" class="status-msg"></div>
    </section>

  </div>

  <script src="/static/app.js?v=3"></script>
</body>
</html>
